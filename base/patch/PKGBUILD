# Maintainer: Zelun Kong <zelun.kong@outlook.com>

pkgname=patch
pkgver=2.7.6
pkgrel=1
pkgdesc="A utility to apply patch files to original sources"
arch=(x86_64)
url="https://www.gnu.org/software/patch/"
depends=(attr)
makedepends=(ed)
optdepends=("ed: for patch -e functionality")
source=(https://ftp.gnu.org/gnu/$pkgname/$pkgname-$pkgver.tar.xz{,.sig}
        f290f48a621867084884bfff87f8093c15195e6a.patch
        b5a91a01e5d0897facdd0f49d64b76b0f02b43e1.patch
        123eaff0d5d1aebe128295959435b9ca5909c26d.patch
        3fcd042d26d70856e826a42b5f93dc4854d80bf0.patch
        1e9104c18019e7dc6b5590aea4b1d4f9d8ecfd56.patch
        458ac51a05426c1af9aa6bf1342ecf60728c19b4.patch
        19599883ffb6a450d2884f081f8ecf68edbed7ee.patch
        369dcccdfa6336e5a873d6d63705cfbe04c55727.patch
        9c986353e420ead6e706262bf204d6e03322c300.patch)
sha256sums=('ac610bda97abe0d9f6b7c963255a11dcb196c25e337c61f94e4778d632f1d8fd'
            'SKIP'
            '38d28c34524c6ac4585d47e0fe8349508e9e4b014872798cb2bf2bc48e5af2d4'
            'b7829673090bcd74110ac040cc6e503113ef770e48d34758c04418cf9c8bfa87'
            '9158cb3cd4bed0c4fe5a7f1254e0e2642e0ad583dc8b5df8ee296a13d695270d'
            '473f8a7fa8152a3c7803633e2a3072dab545b74377ea618451ceda4283643364'
            '8258a3522b30e9d5a5681b08d34a560ea640f63504c35600b3ba885e69f28026'
            'd5d4f65beaba61e4b0278c46255f3dd2d1e05d53d51c0833c206b4837f0cd211'
            '6d64a8b8ddfb802ec0aa804388eb5ef51ac808c7a5c111d10490c270eb4fe727'
            'e1fc8a8aa2cad71b2a6207241ea71a33a7e3dacb8533ad54af35170c5a6562d1'
            '4b9e81985ca057fa39daed34a4710eb113f08b3d1ce77a7121ddd8e3fae8007a')
validpgpkeys=('259B3792B3D6D319212CC4DCD5BF9FEB0313653A')

prepare() {
  cd $pkgname-$pkgver

  local src
  for src in "${source[@]}"; do
    src=${src%%::*}
    src=${src##*/}
    [[ $src = *.patch ]] || continue
    msg2 "Applying patch $src..."
    patch -Np1 < "../$src"
  done

  autoreconf -fiv
}

build() {
  cd $pkgname-$pkgver

  ./configure \
    --prefix=/usr

  make
}

check() {
  cd $pkgname-$pkgver

  make check
}

package() {
  cd $pkgname-$pkgver

  make DESTDIR="$pkgdir/" install
}
