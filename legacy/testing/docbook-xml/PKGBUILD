# Maintainer: Zelun Kong <zelun.kong@outlook.com>

pkgname=docbook-xml
pkgver=4.5
pkgrel=1
epoch=1
pkgdesc="A widely used XML scheme for writing documentation and help"
arch=('any')
url="https://www.oasis-open.org/docbook/"
depends=(libxml2)
install=$pkgname.install
source=(https://docbook.org/xml/$pkgver/$pkgname-$pkgver.zip)
sha256sums=('4e4e037a2b83c98c6c94818390d4bdd3f6e10f6ec62dd79188594e26190dc7b4')

package() {
  mkdir -p "$pkgdir/etc/xml"
  xmlcatalog --noout --create "$pkgdir/etc/xml/docbook-xml"

  mkdir -p "$pkgdir/usr/share/xml/docbook/xml-dtd-$pkgver"
  cp -dr docbook.cat *.dtd ent/ *.mod "$pkgdir/usr/share/xml/docbook/xml-dtd-$pkgver"

  xmlcatalog --noout --add "public" \
    "-//OASIS//DTD DocBook XML V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/docbookx.dtd" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//DTD DocBook$xml CALS Table Model V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/calstblx.dtd" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//DTD XML Exchange Table Model 19990315//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/soextblx.dtd" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook$xml Information Pool V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/dbpoolx.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook$xml Document Hierarchy V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/dbhierx.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook$xml Additional General Entities V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/dbgenent.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook$xml Notations V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/dbnotnx.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook$xml Character Entities V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/dbcentx.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook XML HTML Tables V$pkgver//EN" \
    "http://www.oasis-open.org/docbook/xml/$pkgver/htmltblx.mod" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "rewriteSystem" \
    "http://www.oasis-open.org/docbook/xml/$pkgver" \
    "/usr/share/xml/docbook/xml-dtd-$pkgver" \
    "$pkgdir/etc/xml/docbook-xml"
  xmlcatalog --noout --add "rewriteURI" \
    "http://www.oasis-open.org/docbook/xml/$pkgver" \
    "/usr/share/xml/docbook/xml-dtd-$pkgver" \
    "$pkgdir/etc/xml/docbook-xml"

  find "$pkgdir" -type f -exec chmod -c a-x {} +
  chmod -Rc u=rwX,go=rX "$pkgdir"
}
