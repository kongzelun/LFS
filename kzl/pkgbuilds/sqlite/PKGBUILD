# Maintainer: Zelun Kong <zelun.kong@outlook.com>

pkgname=sqlite
pkgver=3.33.0000
pkgrel=1
epoch=1
pkgdesc="A C library that implements an SQL database engine"
arch=('x86_64')
url="https://www.sqlite.org"
makedepends=(tcl)
source=($url/2020/$pkgname-src-${pkgver//./}.zip)
sha256sums=('90bf7604a5aa26deece551af7a665fd4ce3d854ea809899c0e4bb19a69d609b8')

build() {
  cd $pkgname-src-${pkgver//./}

  ./configure \
    --prefix=/usr \
    --disable-static \
    --disable-amalgamation \
    --enable-fts5 \
    --enable-json1 \
    --enable-rtree

  CFLAGS="$CFLAGS \
    -DSQLITE_SECURE_DELETE \
    -DSQLITE_ENABLE_COLUMN_METADATA \
    -DSQLITE_ENABLE_DBSTAT_VTAB \
    -DSQLITE_ENABLE_UNLOCK_NOTIFY"

  make
  make showdb showjournal showstat4 showwal sqldiff sqlite3_analyzer
}

package() {
  cd $pkgname-src-${pkgver//./}

  make DESTDIR="$pkgdir/" install
  install -Dm755 showdb showjournal showstat4 showwal sqldiff sqlite3_analyzer "$pkgdir"/usr/bin/
}
